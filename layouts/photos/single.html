{{ define "main" }}
<article>

    <!-- Get image base path and type -->
    {{ $srcBase := .Site.Params.photosURL }}
    {{ $srcFile := index (findRE "^([^.]+)" .Params.src 1) 0 }}
    {{ $srcFileFull := print $srcBase "/" (index (findRE "^([^.]+)" .Params.src 1) 0) }}
    {{ $srcExt := index (findRE "\\.[^.]*$|$" .Params.src 1) 0 }}
    {{ $srcType := replaceRE ".jpg" "jpeg" $srcExt }}

    <!-- Get explicit width and height to include in img tag -->
    {{ $srcWidth := .Params.width }}
    {{ $srcHeight := .Params.height }}

    <figure class="photo-frame">
        <a href="{{ $srcBase }}/original/{{ $srcFile }}{{ $srcExt }}">
            <picture>
                <source srcset="{{ $srcFileFull }}-640.webp 640w, {{ $srcFileFull }}-1280.webp 1280w" alt="{{ .Title }}" type="image/webp">
                <source srcset="{{ $srcFileFull }}-640{{ $srcExt }} 640w, {{ $srcFileFull }}-1280{{ $srcExt }} 1280w" alt="{{ .Title }}" type="image/{{ $srcType }}">
                <img src="{{ $srcFileFull }}-640{{ $srcExt }}" alt="{{ .Title }}" width="{{ $srcWidth }}" height="{{ $srcHeight }}">
            </picture>
        </a>
    </figure>
    <header class="post-header" style="max-width:640px;margin:auto;">
        <h1>{{ .Title }}</h1>
        {{- if isset .Params "date" -}}
            <time>{{ .Date.Format "January 2, 2006" }}</time>
        {{- end -}}
    </header>
    <div style="max-width:640px;margin:auto;">
        {{- .Content -}}
    </div>
</article>
{{ end }}

{{ define "style" }}
<style>
    main#content {
        max-width: 100%;
    }

    main#content .photo-frame {
        display: flex;
        max-height: calc(100vh - 180px);
    }

    main#content article img {
        object-fit: contain;
        max-height: 100%;
    }
</style>
{{ end }}
