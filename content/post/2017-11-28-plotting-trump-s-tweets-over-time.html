---
title: Plotting Trump's Tweets Over Time
author: Dan Snow
date: '2017-11-28'
slug: trump-tweets
categories: R
---



<p>Importing the necessary libraries and setting timezones. You will almost certainly have to play around with timezones to get this script to work properly. Try the following commands, though be sure to change back.</p>
<pre class="r"><code>Sys.setenv(TZ = &quot;America/Chicago&quot;)
options(tz = &quot;America/Chicago&quot;)

library(tidyverse)
library(lubridate)
library(jsonlite)
library(maptools)
library(scales)
library(viridis)
library(KernSmooth)</code></pre>
<p>Importing data from the Trump Twitter Archive GitHub.</p>
<pre class="r"><code>temp &lt;- tempfile()
download.file(&quot;https://github.com/bpb27/trump_tweet_data_archive/raw/master/condensed_2017.json.zip&quot;,
              temp)
unzip(temp, &quot;condensed_2017.json&quot;)
tt.df &lt;- fromJSON(&quot;condensed_2017.json&quot;)
unlink(temp)
rm(temp)</code></pre>
<p>Converting the created_at time to POSIX, removing the date, and changing the timezone</p>
<pre class="r"><code>tt.df$time &lt;- as.POSIXct(tt.df$created_at, format = &quot;%a %b %d %H:%M:%S&quot;, tz = &quot;UTC&quot;)
tt.df$month &lt;- floor_date(tt.df$time, &quot;month&quot;)
tt.df$time &lt;- format(tt.df$time, format = &quot;%H:%M:%S&quot;, tz = &quot;America/New_York&quot;)
tt.df$time &lt;- as.POSIXct(tt.df$time, format = &quot;%H:%M:%S&quot;, tz = &quot;UTC&quot;)</code></pre>
<pre class="r"><code># Get sequence of months since Jan 2017 and DC coordinates
tt.coord &lt;- matrix(c(-77.04, 38.89), nrow = 1)
tt.seq &lt;- seq(from = as.POSIXct(&quot;2017-01-01&quot;, tz = &quot;America/New_York&quot;),
                  length.out = as.numeric(format(now(), &quot;%m&quot;)),
                  by = &quot;months&quot;)

# Get sunrise time for first day of each month for DC
tt.sunrise &lt;- sunriset(
  tt.coord,
  tt.seq,
  direction = &quot;sunrise&quot;,
  POSIXct.out = TRUE)
tt.sunrise$hms &lt;- format(tt.sunrise$time, format = &quot;%H:%M:%S&quot;)
tt.sunrise$hms &lt;- as.POSIXct(tt.sunrise$hms, format = &quot;%H:%M:%S&quot;, tz = &quot;UTC&quot;)</code></pre>
<pre class="r"><code># A small function and extra column which find the density of tweets
tt.density &lt;- function(x) {
  den &lt;- bkde(x = x)
  i &lt;- findInterval(x, den$x)
  return(den$y[i])
}
tt.df$density &lt;- tt.density(as.numeric(tt.df$time))</code></pre>
<pre class="r"><code>ggplot() +
  geom_tile(
    data = tt.df,
    aes(x = month, y = time, color = density),
    size = .3) +
  # geom_smooth(
  #   data = filter(tt.df, hour(tt.df$time) &gt;= 5, hour(tt.df$time) &lt;= 11),
  #   aes(x = month, y = time),
  #   size = 1.3,
  #   method= &#39;lm&#39;,
  #   se = FALSE,
  #   color = &quot;blue2&quot;) +
  geom_tile(
    data = tt.sunrise,
    aes(time, hms),
    size = 1.3,
    color = &quot;indianred&quot;,
    alpha = 0.8) +
  scale_y_datetime(
    labels = date_format(&quot;%H:%M&quot;),
    breaks = date_breaks(&quot;2 hour&quot;),
    expand = c(0, 0),
    limits = c(as.POSIXct(paste(Sys.Date() - 1, &quot;18:00:00&quot;)),
              as.POSIXct(paste(Sys.Date(), &quot;18:00:00&quot;)))) +
  scale_x_datetime(
    breaks = date_breaks(&quot;1 month&quot;),
    labels = date_format(&quot;%b, %y&quot;),
    expand = c(0, 0)) +
  labs(
    x = &quot;Month&quot;,
    y = &quot;Time&quot;,
    title = &quot;Trump Tweets Over Time&quot;,
    subtitle = &quot;Tweets by month by hour. Collected from trumptwitterarchive.com.&quot;,
    color = &quot;Density&quot;,
    caption = &quot;*Red lines represent sunrise times for the first of each month.&quot;) +
  scale_color_viridis(
    breaks = c(5.0e-06, 1.0e-05, 1.5e-05, 2.0e-05, 2.5e-05),
    labels = c(&quot;Low&quot;, &quot;&quot;, &quot;Med&quot;, &quot;&quot;, &quot;High&quot;)) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(size = 10, margin = margin(t = 8, unit = &quot;pt&quot;)),
    axis.text.y = element_text(size = 12),
    axis.title.y = element_blank(),
    axis.title.x = element_blank(),
    plot.title = element_text(size = 16, face = &quot;bold&quot;),
    plot.subtitle = element_text(size = 12, margin = margin(b = 8, unit = &quot;pt&quot;)),
    plot.caption = element_text(margin = margin(t = 12, unit = &quot;pt&quot;)),
    plot.margin = unit(c(10,10,20,10), &quot;pt&quot;))</code></pre>
<p><img src="/post/2017-11-28-plotting-trump-s-tweets-over-time_files/figure-html/plot-1.png" width="672" /></p>
